﻿﻿﻿# BlobStoreBlob storage build upon rocksDB with a WiscKey like storage systemArbeitsweise:zunächst werden die Daten in das VLog geschrieben. Für alle Familien gitb es nur einen Satz an VLog Dateien. Das VLOg ist eine einfache sequentielle Datei. Zunächst kommt der Trenner, dann die VLog Beschreibung (KEY, LENGTH, CHUNKNO), danach die Binärdaten. Während der Ablage der Binärdaten wird ein SHA-256 Hash gebildet.Bei Chuncking werden die einzenlen Chunks direkt abgelegt.Nach erfolgreichem Schreibvorgang wird die Pos im VLOG und der Hash zusammen mit den anderen Daten in die RocksDB unter der Familie eingetragen.## LöschvorgangEin Löschvorgang besteht im Wesentlichen daraus, in der RocksDB den Eintrag als gelöscht zu markieren.## Hintergrund Tasks## vLog CompactionDer Hintergrundtaks für das vLog prüft die für die Compaction des vLog geltenden Bestimmungen. Ist eine davon betroffen, wird das vLog gesperrt und der entsprechende Compactvorgang angestoßen.## Container CompactionEin Hintergrundtask geht dann durch alle Container und berechnet, wieviel Freiplatz in dem jeweiligen Container enthalten ist. Ist dieser größer als vCntDeleteTreshHold (Prozentangabe) wird der Container komprimiert. Grundlage ist die Bytegröße.## Container CompressionEin Hintergrundtask geht durch alle Container und berechnet, ob der Container zur Komprimierung ansteht. Wenn ja, wird für diesen Container die Comprimierung gestartet.## Compact VorgangEin Compact Vorgang wird initiiert, wenn eine VLog Datei die kritische Größe erreicht hat, vlogMaxSize oder die max. Anzahl der Dokumente erreicht hat, vlogMaxCount oder der letzte schreibende Zugriff > ist als vlogAge. Dabei werden dann alle Dokumente im vlog der reiche nach verarbeitet. - Anlesen der vlogDescription- Checken des sDB Eintrages  - vlog file identisch ? compact : recovery  - key identisch -> compact- übertragen in vContainer, bilden von Hash- check des Hashs ? weiter : Fehlerbehandlung- update des DB Eintrages## RetentionEin Hintergrund Task wertet die Retention der Einträge aus. Dabei werden alle Dokumenteneinträge der DB mit Retention verarbeitet. Ist die Retention abgelaufen, wird das Dokument als gelöscht markiert.## Compact ContainerEin Compact-Vorgang wird für einen Container im Hintergrund aufgerufen. Dabei werden folgende Schritte durchgeführt- Erzeugen eines neuen Containers- Anlesen der vcnt Description- Checken des sDB Eintrages  - vcnt.container identisch ? compress : recovery  - key identisch -> compress- übertragen in den neuen vContainer- Eintragen in dLog File- alter Container verarbeitet, , neuen Container registrieren- update der DB Einträge (Bulk update)- alten Container entsorgen## KompressionAb einem gewissen Alter (vCntCompressAge) werden Container automatisch kompromiert. Als Verfahren wird vCntCompressionMode verwendet.